<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <h:head>
        <title>Venta de Medicamentos</title>
        <link href="../../resources/css/style.css" rel="stylesheet" type="text/css"/>
        <f:event type="preRenderView" listener="#{detVentaC.listarVta()}" />
    </h:head>
    <h:body>
        <center>
            <h1>Consulta y detalle de Ventas realizadas</h1>
            <p:growl id="mensaje" showDetail="true" >
                <p:autoUpdate/>
            </p:growl>
            <p:growl id="growl-sticky" for="sticky-key" showDetail="true" sticky="true" />
            <h:form id="form">
                <p:panelGrid>
                    <p:row>
                        <p:column colspan="2" style="font-weight: bold; color: orangered">
                            <p:outputLabel value="Fecha Inicio" for="calendar1" />  
                        </p:column>                                                        
                        <p:column colspan="2" style="font-weight: bold; color: #D20005;">
                            <p:datePicker id="calendar1" value="#{ventasC.fecha1}" locale="es" monthNavigator="true" pattern="dd-MM-yyyy"/>                        
                        </p:column>
                        <p:column colspan="2" style="font-weight: bold; color: orangered">
                            <p:outputLabel value="Fecha Final" for="calendar2" />
                        </p:column>                                                        
                        <p:column colspan="2" style="font-weight: bold; color: #D20005;">
                            <p:datePicker id="calendar2" value="#{ventasC.fecha2}" locale="es" monthNavigator="true" pattern="dd-MM-yyyy"/>                        
                        </p:column>                                                           
                        <p:column colspan="2" style="font-weight: bold; color: #D20005;">
                            <p:selectOneMenu id="anio" value="#{ventasC.anio}" style="width:125px">
                                <f:selectItem itemLabel="Año" itemValue="" />
                                <f:selectItem itemLabel="2021" itemValue="2021" />
                                <f:selectItem itemLabel="2020" itemValue="2020" />
                                <f:selectItem itemLabel="2019" itemValue="2019" />                                
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                </p:panelGrid>        

                <p/>  
                <br/>
                <p:dataTable id="tblVenta" var="product" value="#{detVentaC.lstVenta}" emptyMessage="Se tiene la lista sin ventas"
                             selectionMode="single" selection="#{detVentaC.selectedVta}" rowKey="#{product.codDoc}" sortBy="#{product.monto}">
                    <f:facet name="header">Ventas Realizadas </f:facet>
                    <p:ajax event="rowSelect" listener="#{detVentaC.onRowSelect}" update="form:tblDetalle" />
<!--                    <p:column headerText="Id" sortBy="#{product.codDoc}">
                        <h:outputText value="#{product.codDoc}" />
                    </p:column>-->
                    <p:column headerText="Ticket" sortBy="#{product.nroDoc}" filterBy="#{product.nroDoc}">
                        <h:outputText value="#{product.nroDoc}" />
                    </p:column>
                    <p:column headerText="Fecha" sortBy="#{product.fecha}" filterBy="#{product.fecha}">
                        <h:outputText value="#{product.fecha}" />
                    </p:column>
                    <p:column headerText="Paciene" sortBy="#{product.nombre}" filterBy="#{product.nombre}">
                        <h:outputText value="#{product.nombre}" />
                    </p:column>                    
                    <p:column headerText="Observación" >
                        <h:outputText value="#{product.obs}" />
                    </p:column>
                    <p:column headerText="Valor s/" sortBy="#{product.monto}">
                        <h:outputText value="#{product.monto}" />
                    </p:column>  
                    <p:summaryRow>
                        <p:column colspan="4" style="text-align:right">
                            <h:outputText value="Total:" />
                        </p:column>
                        <p:column>
                            <h:outputText value="#{detVentaC.randomPrice}">
                                <f:convertNumber type="currency" currencySymbol="S/ " />
                            </h:outputText>
                        </p:column>
                    </p:summaryRow>

                    <p:summaryRow>
                        <!-- this column is here so dataTable works correctly with draggableColumns -->
                        <p:column style="visibility: hidden;"/>

                        <p:column style="text-align: right">
                            <h:outputText id="SUM-VAL"
                                          value="#{detVentaC.randomPrice['monto']}" />
                        </p:column>        

                    </p:summaryRow>
                    <f:facet name="footer">
                        Hay en total: #{fn:length(detVentaC.lstVenta)} registros de venta.
                    </f:facet>
                </p:dataTable>
                <br/>
                <p:dataTable id="tblDetalle" var="detProduct" value="#{detVentaC.lstDetVenta}"  emptyMessage="Se tiene la lista sin detalle">
                    <f:facet name="header">Detalle del ticket  </f:facet>
                    <p:column headerText="Id" style="width: 5%;" >
                        <h:outputText value="#{detProduct.codigoMed}" />
                    </p:column>
                    <p:column headerText="Comercial">
                        <h:outputText value="#{detProduct.comercial}" />
                    </p:column>
                    <p:column headerText="Genérico">
                        <h:outputText value="#{detProduct.generico}" />
                    </p:column>
                    <p:column headerText="Presentación">
                        <h:outputText value="#{detProduct.presentacion}" />
                    </p:column>
                    <p:column headerText="Proveedor">
                        <h:outputText value="#{detProduct.provAbr}" />
                    </p:column>                                        
                    <p:column headerText="Precio" style="width: 5%">
                        <h:outputText value="#{detProduct.precio}" />
                    </p:column>
                    <p:column headerText="Cant." style="width: 5%;" >
                        <h:outputText value="#{detProduct.cantidad}" />
                    </p:column>
                    <p:column headerText="SubTotal s/" style="width: 7%;" >
                        <h:outputText value="#{detProduct.subtotal}" />
                    </p:column>
                    <f:facet name="footer">
                        Hay en total #{fn:length(detVentaC.lstDetVenta)} medicamentos.
                    </f:facet>
                </p:dataTable>
            </h:form>        
        </center>
        <script src="../../resources/js/Calendar.js" type="text/javascript"></script>

    </h:body>
</html>

